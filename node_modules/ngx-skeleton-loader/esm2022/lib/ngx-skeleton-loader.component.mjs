import { Component, Input, isDevMode, ChangeDetectionStrategy, Optional, Inject, } from '@angular/core';
import { NGX_SKELETON_LOADER_CONFIG, } from './ngx-skeleton-loader-config.types';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class NgxSkeletonLoaderComponent {
    constructor(config) {
        this.config = config;
        const { appearance = 'line', animation = 'progress', theme = null, loadingText = 'Loading...', count = 1, ariaLabel = 'loading', } = config || {};
        this.appearance = appearance;
        this.animation = animation;
        this.theme = theme;
        this.loadingText = loadingText;
        this.count = count;
        this.items = [];
        this.ariaLabel = ariaLabel;
    }
    ngOnInit() {
        this.validateInputValues();
    }
    validateInputValues() {
        // Checking if it's receiving a numeric value (string having ONLY numbers or if it's a number)
        if (!/^\d+$/.test(`${this.count}`)) {
            // Shows error message only in Development
            if (isDevMode()) {
                console.error(`\`NgxSkeletonLoaderComponent\` need to receive 'count' a numeric value. Forcing default to "1".`);
            }
            this.count = 1;
        }
        //Force count to 1 when custom-content is used
        if (this.appearance === 'custom-content') {
            // Shows error message only in Development
            if (isDevMode() && this.count !== 1) {
                console.error(`\`NgxSkeletonLoaderComponent\` enforces elements with "custom-content" appearance as DOM nodes. Forcing "count" to "1".`);
                this.count = 1;
            }
        }
        this.items.length = this.count;
        const allowedAnimations = ['progress', 'progress-dark', 'pulse', 'false'];
        if (allowedAnimations.indexOf(String(this.animation)) === -1) {
            // Shows error message only in Development
            if (isDevMode()) {
                console.error(`\`NgxSkeletonLoaderComponent\` need to receive 'animation' as: ${allowedAnimations.join(', ')}. Forcing default to "progress".`);
            }
            this.animation = 'progress';
        }
        if (['circle', 'line', 'custom-content', ''].indexOf(String(this.appearance)) === -1) {
            // Shows error message only in Development
            if (isDevMode()) {
                console.error(`\`NgxSkeletonLoaderComponent\` need to receive 'appearance' as: circle or line or custom-content or empty string. Forcing default to "''".`);
            }
            this.appearance = '';
        }
        // This code is not using optional chaining since it's only supported on Angular CLI v12
        //  - more details in this comment https://github.com/angular/angular-cli/issues/20471#issuecomment-815599616
        // Which raises issues on the consumer's side. E.G: https://github.com/willmendesneto/ngx-skeleton-loader/issues/150#issuecomment-1638612329
        const { theme } = this.config || {};
        if (!!theme && !!theme.extendsFromRoot && this.theme !== null) {
            // Shows error message only in Development
            this.theme = { ...this.config.theme, ...this.theme };
        }
    }
    ngOnChanges(changes) {
        // Avoiding multiple calls for the same input in case there's no changes in the fields
        // Checking if the fields that require validation are available and if they were changed
        // In case were not changed, we stop the function. Otherwise, `validateInputValues` will be called.
        if (['count', 'animation', 'appearance'].find(key => changes[key] && (changes[key].isFirstChange() || changes[key].previousValue === changes[key].currentValue))) {
            return;
        }
        this.validateInputValues();
    }
    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.8", ngImport: i0, type: NgxSkeletonLoaderComponent, deps: [{ token: NGX_SKELETON_LOADER_CONFIG, optional: true }], target: i0.ɵɵFactoryTarget.Component }); }
    /** @nocollapse */ static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.0.8", type: NgxSkeletonLoaderComponent, selector: "ngx-skeleton-loader", inputs: { count: "count", loadingText: "loadingText", appearance: "appearance", animation: "animation", ariaLabel: "ariaLabel", theme: "theme" }, usesOnChanges: true, ngImport: i0, template: "@for (item of items; track item) {\n  <div\n    class=\"skeleton-loader\"\n    [attr.aria-label]=\"ariaLabel\"\n    aria-busy=\"true\"\n    aria-valuemin=\"0\"\n    aria-valuemax=\"100\"\n    [attr.aria-valuetext]=\"loadingText\"\n    role=\"progressbar\"\n    tabindex=\"-1\"\n    [ngClass]=\"{\n      'custom-content': appearance === 'custom-content',\n      circle: appearance === 'circle',\n      progress: animation === 'progress',\n      'progress-dark': animation === 'progress-dark',\n      pulse: animation === 'pulse'\n    }\"\n    [ngStyle]=\"theme\"\n    >\n    @if (appearance  === 'custom-content') {\n      <ng-content></ng-content>\n    }\n  </div>\n}\n", styles: [".skeleton-loader{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;border-radius:4px;width:100%;height:20px;display:inline-block;margin-bottom:10px;will-change:transform}.skeleton-loader:after,.skeleton-loader:before{box-sizing:border-box}.skeleton-loader.circle{width:40px;height:40px;margin:5px;border-radius:50%}.skeleton-loader.progress,.skeleton-loader.progress-dark{transform:translateZ(0)}.skeleton-loader.progress:after,.skeleton-loader.progress:before,.skeleton-loader.progress-dark:after,.skeleton-loader.progress-dark:before{box-sizing:border-box}.skeleton-loader.progress:before,.skeleton-loader.progress-dark:before{animation:progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:\"\"}.skeleton-loader.progress:before{background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}.skeleton-loader.progress-dark:before{background-image:linear-gradient(90deg,transparent,rgba(0,0,0,.2),transparent)}.skeleton-loader.pulse{animation:pulse 1.5s cubic-bezier(.4,0,.2,1) infinite;animation-delay:.5s}.skeleton-loader.custom-content{height:100%;background:none}@media (prefers-reduced-motion: reduce){.skeleton-loader.pulse,.skeleton-loader.progress-dark,.skeleton-loader.custom-content,.skeleton-loader.progress:before{animation:none}.skeleton-loader.progress:before,.skeleton-loader.progress-dark,.skeleton-loader.custom-content{background-image:none}}@media screen and (min-device-width: 1200px){.skeleton-loader{-webkit-user-select:none;user-select:none;cursor:wait}}@keyframes progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}@keyframes pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}\n"], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.8", ngImport: i0, type: NgxSkeletonLoaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ngx-skeleton-loader', changeDetection: ChangeDetectionStrategy.OnPush, template: "@for (item of items; track item) {\n  <div\n    class=\"skeleton-loader\"\n    [attr.aria-label]=\"ariaLabel\"\n    aria-busy=\"true\"\n    aria-valuemin=\"0\"\n    aria-valuemax=\"100\"\n    [attr.aria-valuetext]=\"loadingText\"\n    role=\"progressbar\"\n    tabindex=\"-1\"\n    [ngClass]=\"{\n      'custom-content': appearance === 'custom-content',\n      circle: appearance === 'circle',\n      progress: animation === 'progress',\n      'progress-dark': animation === 'progress-dark',\n      pulse: animation === 'pulse'\n    }\"\n    [ngStyle]=\"theme\"\n    >\n    @if (appearance  === 'custom-content') {\n      <ng-content></ng-content>\n    }\n  </div>\n}\n", styles: [".skeleton-loader{box-sizing:border-box;overflow:hidden;position:relative;background:#eff1f6 no-repeat;border-radius:4px;width:100%;height:20px;display:inline-block;margin-bottom:10px;will-change:transform}.skeleton-loader:after,.skeleton-loader:before{box-sizing:border-box}.skeleton-loader.circle{width:40px;height:40px;margin:5px;border-radius:50%}.skeleton-loader.progress,.skeleton-loader.progress-dark{transform:translateZ(0)}.skeleton-loader.progress:after,.skeleton-loader.progress:before,.skeleton-loader.progress-dark:after,.skeleton-loader.progress-dark:before{box-sizing:border-box}.skeleton-loader.progress:before,.skeleton-loader.progress-dark:before{animation:progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;z-index:1;top:0;left:0;width:200px;height:100%;content:\"\"}.skeleton-loader.progress:before{background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}.skeleton-loader.progress-dark:before{background-image:linear-gradient(90deg,transparent,rgba(0,0,0,.2),transparent)}.skeleton-loader.pulse{animation:pulse 1.5s cubic-bezier(.4,0,.2,1) infinite;animation-delay:.5s}.skeleton-loader.custom-content{height:100%;background:none}@media (prefers-reduced-motion: reduce){.skeleton-loader.pulse,.skeleton-loader.progress-dark,.skeleton-loader.custom-content,.skeleton-loader.progress:before{animation:none}.skeleton-loader.progress:before,.skeleton-loader.progress-dark,.skeleton-loader.custom-content{background-image:none}}@media screen and (min-device-width: 1200px){.skeleton-loader{-webkit-user-select:none;user-select:none;cursor:wait}}@keyframes progress{0%{transform:translate3d(-200px,0,0)}to{transform:translate3d(calc(200px + 100vw),0,0)}}@keyframes pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}\n"] }]
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [NGX_SKELETON_LOADER_CONFIG]
                }, {
                    type: Optional
                }] }], propDecorators: { count: [{
                type: Input
            }], loadingText: [{
                type: Input
            }], appearance: [{
                type: Input
            }], animation: [{
                type: Input
            }], ariaLabel: [{
                type: Input
            }], theme: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNrZWxldG9uLWxvYWRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2tlbGV0b24tbG9hZGVyL3NyYy9saWIvbmd4LXNrZWxldG9uLWxvYWRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2tlbGV0b24tbG9hZGVyL3NyYy9saWIvbmd4LXNrZWxldG9uLWxvYWRlci5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBRVQsS0FBSyxFQUNMLFNBQVMsRUFDVCx1QkFBdUIsRUFHdkIsUUFBUSxFQUNSLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBR0wsMEJBQTBCLEdBQzNCLE1BQU0sb0NBQW9DLENBQUM7OztBQVE1QyxNQUFNLE9BQU8sMEJBQTBCO0lBd0JyQyxZQUFvRSxNQUFnQztRQUFoQyxXQUFNLEdBQU4sTUFBTSxDQUEwQjtRQUNsRyxNQUFNLEVBQ0osVUFBVSxHQUFHLE1BQU0sRUFDbkIsU0FBUyxHQUFHLFVBQVUsRUFDdEIsS0FBSyxHQUFHLElBQUksRUFDWixXQUFXLEdBQUcsWUFBWSxFQUMxQixLQUFLLEdBQUcsQ0FBQyxFQUNULFNBQVMsR0FBRyxTQUFTLEdBQ3RCLEdBQUcsTUFBTSxJQUFJLEVBQUUsQ0FBQztRQUVqQixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztJQUM3QixD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Q0FBQztpSUF0SFUsMEJBQTBCLGtCQXdCakIsMEJBQTBCO3FIQXhCbkMsMEJBQTBCLGtPQ3ZCdkMsK3BCQXdCQTs7MkZERGEsMEJBQTBCO2tCQU50QyxTQUFTOytCQUNFLHFCQUFxQixtQkFHZCx1QkFBdUIsQ0FBQyxNQUFNOzswQkEwQmxDLE1BQU07MkJBQUMsMEJBQTBCOzswQkFBRyxRQUFRO3lDQW5CekQsS0FBSztzQkFESixLQUFLO2dCQUlOLFdBQVc7c0JBRFYsS0FBSztnQkFJTixVQUFVO3NCQURULEtBQUs7Z0JBSU4sU0FBUztzQkFEUixLQUFLO2dCQUlOLFNBQVM7c0JBRFIsS0FBSztnQkFJTixLQUFLO3NCQURKLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIE9uSW5pdCxcbiAgSW5wdXQsXG4gIGlzRGV2TW9kZSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIE9uQ2hhbmdlcyxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgT3B0aW9uYWwsXG4gIEluamVjdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBOZ3hTa2VsZXRvbkxvYWRlckNvbmZpZyxcbiAgTmd4U2tlbGV0b25Mb2FkZXJDb25maWdUaGVtZSxcbiAgTkdYX1NLRUxFVE9OX0xPQURFUl9DT05GSUcsXG59IGZyb20gJy4vbmd4LXNrZWxldG9uLWxvYWRlci1jb25maWcudHlwZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtc2tlbGV0b24tbG9hZGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25neC1za2VsZXRvbi1sb2FkZXIuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25neC1za2VsZXRvbi1sb2FkZXIuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgTmd4U2tlbGV0b25Mb2FkZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIHN0YXRpYyBuZ0FjY2VwdElucHV0VHlwZV9jb3VudDogbnVtYmVyIHwgc3RyaW5nO1xuICBzdGF0aWMgbmdBY2NlcHRJbnB1dFR5cGVfYW5pbWF0aW9uOiBib29sZWFuIHwgc3RyaW5nO1xuXG4gIEBJbnB1dCgpXG4gIGNvdW50OiBOZ3hTa2VsZXRvbkxvYWRlckNvbmZpZ1snY291bnQnXTtcblxuICBASW5wdXQoKVxuICBsb2FkaW5nVGV4dDogTmd4U2tlbGV0b25Mb2FkZXJDb25maWdbJ2xvYWRpbmdUZXh0J107XG5cbiAgQElucHV0KClcbiAgYXBwZWFyYW5jZTogTmd4U2tlbGV0b25Mb2FkZXJDb25maWdbJ2FwcGVhcmFuY2UnXTtcblxuICBASW5wdXQoKVxuICBhbmltYXRpb246IE5neFNrZWxldG9uTG9hZGVyQ29uZmlnWydhbmltYXRpb24nXTtcblxuICBASW5wdXQoKVxuICBhcmlhTGFiZWw6IE5neFNrZWxldG9uTG9hZGVyQ29uZmlnWydhcmlhTGFiZWwnXTtcblxuICBASW5wdXQoKVxuICB0aGVtZTogTmd4U2tlbGV0b25Mb2FkZXJDb25maWdUaGVtZTtcblxuICBpdGVtczogQXJyYXk8YW55PjtcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KE5HWF9TS0VMRVRPTl9MT0FERVJfQ09ORklHKSBAT3B0aW9uYWwoKSBwcml2YXRlIGNvbmZpZz86IE5neFNrZWxldG9uTG9hZGVyQ29uZmlnKSB7XG4gICAgY29uc3Qge1xuICAgICAgYXBwZWFyYW5jZSA9ICdsaW5lJyxcbiAgICAgIGFuaW1hdGlvbiA9ICdwcm9ncmVzcycsXG4gICAgICB0aGVtZSA9IG51bGwsXG4gICAgICBsb2FkaW5nVGV4dCA9ICdMb2FkaW5nLi4uJyxcbiAgICAgIGNvdW50ID0gMSxcbiAgICAgIGFyaWFMYWJlbCA9ICdsb2FkaW5nJyxcbiAgICB9ID0gY29uZmlnIHx8IHt9O1xuXG4gICAgdGhpcy5hcHBlYXJhbmNlID0gYXBwZWFyYW5jZTtcbiAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1hdGlvbjtcbiAgICB0aGlzLnRoZW1lID0gdGhlbWU7XG4gICAgdGhpcy5sb2FkaW5nVGV4dCA9IGxvYWRpbmdUZXh0O1xuICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICB0aGlzLml0ZW1zID0gW107XG4gICAgdGhpcy5hcmlhTGFiZWwgPSBhcmlhTGFiZWw7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnZhbGlkYXRlSW5wdXRWYWx1ZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVJbnB1dFZhbHVlcygpIHtcbiAgICAvLyBDaGVja2luZyBpZiBpdCdzIHJlY2VpdmluZyBhIG51bWVyaWMgdmFsdWUgKHN0cmluZyBoYXZpbmcgT05MWSBudW1iZXJzIG9yIGlmIGl0J3MgYSBudW1iZXIpXG4gICAgaWYgKCEvXlxcZCskLy50ZXN0KGAke3RoaXMuY291bnR9YCkpIHtcbiAgICAgIC8vIFNob3dzIGVycm9yIG1lc3NhZ2Ugb25seSBpbiBEZXZlbG9wbWVudFxuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgYFxcYE5neFNrZWxldG9uTG9hZGVyQ29tcG9uZW50XFxgIG5lZWQgdG8gcmVjZWl2ZSAnY291bnQnIGEgbnVtZXJpYyB2YWx1ZS4gRm9yY2luZyBkZWZhdWx0IHRvIFwiMVwiLmAsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLmNvdW50ID0gMTtcbiAgICB9XG5cbiAgICAvL0ZvcmNlIGNvdW50IHRvIDEgd2hlbiBjdXN0b20tY29udGVudCBpcyB1c2VkXG4gICAgaWYgKHRoaXMuYXBwZWFyYW5jZSA9PT0gJ2N1c3RvbS1jb250ZW50Jykge1xuICAgICAgLy8gU2hvd3MgZXJyb3IgbWVzc2FnZSBvbmx5IGluIERldmVsb3BtZW50XG4gICAgICBpZiAoaXNEZXZNb2RlKCkgJiYgdGhpcy5jb3VudCAhPT0gMSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIGBcXGBOZ3hTa2VsZXRvbkxvYWRlckNvbXBvbmVudFxcYCBlbmZvcmNlcyBlbGVtZW50cyB3aXRoIFwiY3VzdG9tLWNvbnRlbnRcIiBhcHBlYXJhbmNlIGFzIERPTSBub2Rlcy4gRm9yY2luZyBcImNvdW50XCIgdG8gXCIxXCIuYCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jb3VudCA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuaXRlbXMubGVuZ3RoID0gdGhpcy5jb3VudDtcblxuICAgIGNvbnN0IGFsbG93ZWRBbmltYXRpb25zID0gWydwcm9ncmVzcycsICdwcm9ncmVzcy1kYXJrJywgJ3B1bHNlJywgJ2ZhbHNlJ107XG4gICAgaWYgKGFsbG93ZWRBbmltYXRpb25zLmluZGV4T2YoU3RyaW5nKHRoaXMuYW5pbWF0aW9uKSkgPT09IC0xKSB7XG4gICAgICAvLyBTaG93cyBlcnJvciBtZXNzYWdlIG9ubHkgaW4gRGV2ZWxvcG1lbnRcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIGBcXGBOZ3hTa2VsZXRvbkxvYWRlckNvbXBvbmVudFxcYCBuZWVkIHRvIHJlY2VpdmUgJ2FuaW1hdGlvbicgYXM6ICR7YWxsb3dlZEFuaW1hdGlvbnMuam9pbihcbiAgICAgICAgICAgICcsICcsXG4gICAgICAgICAgKX0uIEZvcmNpbmcgZGVmYXVsdCB0byBcInByb2dyZXNzXCIuYCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYW5pbWF0aW9uID0gJ3Byb2dyZXNzJztcbiAgICB9XG5cbiAgICBpZiAoWydjaXJjbGUnLCAnbGluZScsICdjdXN0b20tY29udGVudCcsICcnXS5pbmRleE9mKFN0cmluZyh0aGlzLmFwcGVhcmFuY2UpKSA9PT0gLTEpIHtcbiAgICAgIC8vIFNob3dzIGVycm9yIG1lc3NhZ2Ugb25seSBpbiBEZXZlbG9wbWVudFxuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgYFxcYE5neFNrZWxldG9uTG9hZGVyQ29tcG9uZW50XFxgIG5lZWQgdG8gcmVjZWl2ZSAnYXBwZWFyYW5jZScgYXM6IGNpcmNsZSBvciBsaW5lIG9yIGN1c3RvbS1jb250ZW50IG9yIGVtcHR5IHN0cmluZy4gRm9yY2luZyBkZWZhdWx0IHRvIFwiJydcIi5gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5hcHBlYXJhbmNlID0gJyc7XG4gICAgfVxuXG4gICAgLy8gVGhpcyBjb2RlIGlzIG5vdCB1c2luZyBvcHRpb25hbCBjaGFpbmluZyBzaW5jZSBpdCdzIG9ubHkgc3VwcG9ydGVkIG9uIEFuZ3VsYXIgQ0xJIHYxMlxuICAgIC8vICAtIG1vcmUgZGV0YWlscyBpbiB0aGlzIGNvbW1lbnQgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci1jbGkvaXNzdWVzLzIwNDcxI2lzc3VlY29tbWVudC04MTU1OTk2MTZcbiAgICAvLyBXaGljaCByYWlzZXMgaXNzdWVzIG9uIHRoZSBjb25zdW1lcidzIHNpZGUuIEUuRzogaHR0cHM6Ly9naXRodWIuY29tL3dpbGxtZW5kZXNuZXRvL25neC1za2VsZXRvbi1sb2FkZXIvaXNzdWVzLzE1MCNpc3N1ZWNvbW1lbnQtMTYzODYxMjMyOVxuICAgIGNvbnN0IHsgdGhlbWUgfSA9IHRoaXMuY29uZmlnIHx8IHt9O1xuICAgIGlmICghIXRoZW1lICYmICEhdGhlbWUuZXh0ZW5kc0Zyb21Sb290ICYmIHRoaXMudGhlbWUgIT09IG51bGwpIHtcbiAgICAgIC8vIFNob3dzIGVycm9yIG1lc3NhZ2Ugb25seSBpbiBEZXZlbG9wbWVudFxuICAgICAgdGhpcy50aGVtZSA9IHsgLi4udGhpcy5jb25maWchLnRoZW1lLCAuLi50aGlzLnRoZW1lIH07XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIC8vIEF2b2lkaW5nIG11bHRpcGxlIGNhbGxzIGZvciB0aGUgc2FtZSBpbnB1dCBpbiBjYXNlIHRoZXJlJ3Mgbm8gY2hhbmdlcyBpbiB0aGUgZmllbGRzXG4gICAgLy8gQ2hlY2tpbmcgaWYgdGhlIGZpZWxkcyB0aGF0IHJlcXVpcmUgdmFsaWRhdGlvbiBhcmUgYXZhaWxhYmxlIGFuZCBpZiB0aGV5IHdlcmUgY2hhbmdlZFxuICAgIC8vIEluIGNhc2Ugd2VyZSBub3QgY2hhbmdlZCwgd2Ugc3RvcCB0aGUgZnVuY3Rpb24uIE90aGVyd2lzZSwgYHZhbGlkYXRlSW5wdXRWYWx1ZXNgIHdpbGwgYmUgY2FsbGVkLlxuICAgIGlmIChcbiAgICAgIFsnY291bnQnLCAnYW5pbWF0aW9uJywgJ2FwcGVhcmFuY2UnXS5maW5kKFxuICAgICAgICBrZXkgPT5cbiAgICAgICAgICBjaGFuZ2VzW2tleV0gJiYgKGNoYW5nZXNba2V5XS5pc0ZpcnN0Q2hhbmdlKCkgfHwgY2hhbmdlc1trZXldLnByZXZpb3VzVmFsdWUgPT09IGNoYW5nZXNba2V5XS5jdXJyZW50VmFsdWUpLFxuICAgICAgKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudmFsaWRhdGVJbnB1dFZhbHVlcygpO1xuICB9XG59XG4iLCJAZm9yIChpdGVtIG9mIGl0ZW1zOyB0cmFjayBpdGVtKSB7XG4gIDxkaXZcbiAgICBjbGFzcz1cInNrZWxldG9uLWxvYWRlclwiXG4gICAgW2F0dHIuYXJpYS1sYWJlbF09XCJhcmlhTGFiZWxcIlxuICAgIGFyaWEtYnVzeT1cInRydWVcIlxuICAgIGFyaWEtdmFsdWVtaW49XCIwXCJcbiAgICBhcmlhLXZhbHVlbWF4PVwiMTAwXCJcbiAgICBbYXR0ci5hcmlhLXZhbHVldGV4dF09XCJsb2FkaW5nVGV4dFwiXG4gICAgcm9sZT1cInByb2dyZXNzYmFyXCJcbiAgICB0YWJpbmRleD1cIi0xXCJcbiAgICBbbmdDbGFzc109XCJ7XG4gICAgICAnY3VzdG9tLWNvbnRlbnQnOiBhcHBlYXJhbmNlID09PSAnY3VzdG9tLWNvbnRlbnQnLFxuICAgICAgY2lyY2xlOiBhcHBlYXJhbmNlID09PSAnY2lyY2xlJyxcbiAgICAgIHByb2dyZXNzOiBhbmltYXRpb24gPT09ICdwcm9ncmVzcycsXG4gICAgICAncHJvZ3Jlc3MtZGFyayc6IGFuaW1hdGlvbiA9PT0gJ3Byb2dyZXNzLWRhcmsnLFxuICAgICAgcHVsc2U6IGFuaW1hdGlvbiA9PT0gJ3B1bHNlJ1xuICAgIH1cIlxuICAgIFtuZ1N0eWxlXT1cInRoZW1lXCJcbiAgICA+XG4gICAgQGlmIChhcHBlYXJhbmNlICA9PT0gJ2N1c3RvbS1jb250ZW50Jykge1xuICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgIH1cbiAgPC9kaXY+XG59XG4iXX0=